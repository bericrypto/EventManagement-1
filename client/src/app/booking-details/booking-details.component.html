
<div class="booking-details-bg coolvetica">
  <mat-card class="booking-details-card">
    <mat-card-header>
      <mat-card-title>Event Management Search</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="itemForm" (ngSubmit)="searchEvent()" class="booking-details-form">
        <mat-form-field appearance="outline" class="booking-details-field">
          <mat-label>Enter event ID or Title</mat-label>
          <input matInput type="text" formControlName="searchTerm">
        </mat-form-field>
        <button mat-raised-button color="primary" type="submit" [disabled]="!itemForm.valid">Search</button>
      </form>
      <div *ngIf="message" class="booking-details-alert" [ngClass]="{'success': message.type === 'success', 'error': message.type === 'error'}">
        {{ message.text }}
      </div>
      <mat-card *ngIf="searchPerformed">
        <mat-card-title>Search Results</mat-card-title>
        <div class="booking-details-table-wrapper">
          <table mat-table [dataSource]="eventObj" class="booking-details-table">
            <ng-container matColumnDef="eventID">
              <th mat-header-cell *matHeaderCellDef>ID</th>
              <td mat-cell *matCellDef="let event">{{ event.eventID }}</td>
            </ng-container>
            <ng-container matColumnDef="title">
              <th mat-header-cell *matHeaderCellDef>Title</th>
              <td mat-cell *matCellDef="let event">{{ event.title }}</td>
            </ng-container>
            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>Description</th>
              <td mat-cell *matCellDef="let event">{{ event.description | slice:0:50 }}...</td>
            </ng-container>
            <ng-container matColumnDef="dateTime">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let event">{{ event.dateTime | date:'medium' }}</td>
            </ng-container>
            <ng-container matColumnDef="location">
              <th mat-header-cell *matHeaderCellDef>Location</th>
              <td mat-cell *matCellDef="let event">{{ event.location }}</td>
            </ng-container>
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let event">
                <span class="booking-details-badge" [ngClass]="getStatusClass(event.status)">{{ event.status }}</span>
              </td>
            </ng-container>
            <ng-container matColumnDef="allocations">
              <th mat-header-cell *matHeaderCellDef>Allocations</th>
              <td mat-cell *matCellDef="let event">
                <span class="allocation-info" (mouseenter)="showTooltip($event, event.allocations)" (mouseleave)="hideTooltip()">
                  Allocation(s)
                </span>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="['eventID', 'title', 'description', 'dateTime', 'location', 'status', 'allocations']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['eventID', 'title', 'description', 'dateTime', 'location', 'status', 'allocations'];"></tr>
          </table>
        </div>
      </mat-card>
      <div *ngIf="searchPerformed && eventObj.length === 0" class="booking-details-no-results">
        No events found matching your search criteria.
      </div>
      <div *ngIf="tooltipVisible" class="booking-details-tooltip" [style.left.px]="tooltipX" [style.top.px]="tooltipY">
        <div *ngFor="let allocation of tooltipContent; let last = last">
          <p><strong>Quantity:</strong> {{allocation.quantity}}</p>
          <p><strong>Resource Name:</strong> {{allocation.resource.name}}</p>
          <p><strong>Resource Type:</strong> {{allocation.resource.type}}</p>
          <hr *ngIf="!last">
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>